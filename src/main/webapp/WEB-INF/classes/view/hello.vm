##Ensin tarkastetaan että kurssit on ladattu sessiomuuttujaan
$sessioapuri.lataa_kurssit($request)
##Asetetaan parametrit 
#set($qs = $request.getQueryString())
#if($qs)
    #set($params = $queryparser.split($qs))
#end
##Jos lokaali löytyy get-parametrista, vaihdetaan
#if($params.get('locale'))
    $session.setAttribute('selected_locale',$params.get('locale'))
#end
##Lokalisaatiobundlen asetus
#set($bundle = $sessioapuri.bundle($request))

##jos on jo valittu kurssi
#if($params.get('courseId'))
    #if ($session.getAttribute('selected_course_id') != $params.get('courseId'))
        kurssi vaihdettu<br>
        $session.setAttribute('selected_course_id', $params.get('courseId'))
        $session.setAttribute('selected_course', $KurssiKyselyt.kurssiIDlla($session.getAttribute('selected_course_id')))
        $session.setAttribute('selected_course_students', $OpiskelijaKyselyt.kurssinOpiskelijat($session.getAttribute('selected_course')))
        $session.setAttribute('selected_course_parts', $OsallistuminenKyselyt.listaKurssinOsallistumisista($session.getAttribute('selected_course')))
    #end
#end

##jos on jo valittu kurssille haluttu toiminto
#if($params.get('serviceId'))
    $session.setAttribute('selected_service_id', $params.get('serviceId'))
#end



<html>

<head>
    <META charset='utf-8'/>
    <title>KURKI</title>

    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      
    </style>
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

</head>

<body>

<h4>Logged in as: $request.getRemoteUser()</h4>

<div>
<form action="" method=get class="form-inline">
    <select name="courseId" onChange="this.form.submit()" class="form-control form-inline" style="width:700px">
    #foreach($k in $session.getAttribute('user_courses'))
        #if($session.getAttribute('selected_course_id') == $k.idString())
            #if($k.getTila() == "J")
                <option value=$k.idString() selected>* $k.listaString() *</option>
            #else
                <option value=$k.idString() selected>$k.listaString()</option>
            #end
        #else
            #if($k.getTila() == "J")
                <option value=$k.idString()>* $k.listaString() *</option>
            #else
                <option value=$k.idString()>$k.listaString()</option>
            #end
        #end
    #end
    </select>

##Lisätään key:ksi sivun osoite, sivut joilla on vain numero key:nä ei vie vielä mihinkään!
#set ($services = {"1suoritteidenKirjaus.vm" : "Suoritteiden kirjaus" , "2osallistujatiedot.vm" : "Osallistujatietojen muutokset" ,
"3kurssinPerustiedot.vm" : "Kurssin perustietojen muutokset" , "4listat.vm" : "Listat" , "5arvostelu.vm" : "Arvostelu" ,
"6tuloslistat.vm" : "Tuloslistat" , "7jaadytys.vm" : "Kurssin jäädytys"})

    #if ($session.getAttribute('selected_course_id'))
        <select name="serviceId" onChange="this.form.submit()" class="form-control form-inline" style="width:300px">
        #if (!$session.getAttribute('selected_service_id'))
            <option value="" selected>-- $bundle.getString("valitse_toiminto") --</option>
        #end
        #foreach ($s in $services.entrySet())
            #if($session.getAttribute('selected_service_id') == $s.key)
                <option value=$s.key selected>$s.value</option>
            #else
                <option value=$s.key>$s.value</option>
            #end
        #end
        </select>
##        #set ($link = $session.getAttribute('selected_service_id'))
##    <input type=button class="btn" value=select onClick="parent.location='$link'">
    ##$link
    #end
</form>

<div>
Apulinkit testaukseen:
<input type=button class="btn" value=hello onClick="parent.location='hello.vm'">
<input type=button class="btn" value=kurssihaku onClick="parent.location='kurssihaku.vm'">
<input type=button class="btn" value=laskarit onClick="parent.location='laskarit.vm'">
<input type=button class="btn" value=opiskelija onClick="parent.location='opiskelija.vm'">
<input type=button class="btn" value=osallistujaLista onClick="parent.location='osallistujaLista.vm'">
</div>

</div>

##avataan valittu sivu
#parse ($session.getAttribute('selected_service_id'))

