##Ensin tarkastetaan että kurssit on ladattu sessiomuuttujaan
$sessioapuri.auta($request)

##Asetetaan parametrit 
#set($qs = $request.getQueryString())
#if($qs)
    #set($params = $queryparser.split($qs))
#end


##jos on jo valittu kurssi
#if($params.get('courseId'))
    #if ($session.getAttribute('selected_course_id') != $params.get('courseId'))
        kurssi vaihdettu<br>
        $session.setAttribute('selected_course_id', $params.get('courseId'))
        $session.setAttribute('selected_course_students', $OpiskelijaKyselyt.kurssinOpiskelijat($KurssiKyselyt.kurssiIDlla($session.getAttribute('selected_course_id'))))
    #end
#end

##jos on jo valittu kurssille haluttu toiminto
#if($params.get('serviceId'))
    $session.setAttribute('selected_service_id', $params.get('serviceId'))
#end



<html>

<head>
    <META charset='utf-8'/>
    <title>KURKI</title>

    <link href="../bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      
    </style>
    <link href="../bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <script language='JavaScript' type='text/javascript' src='../kurki.js'></script>
</head>

<body>

<h4>Logged in as: $request.getRemoteUser()</h4>

<div>

<form action="" method=get>
    <select name="courseId" onChange="this.form.submit()">
    #foreach($k in $session.getAttribute('user_courses'))
        #if($session.getAttribute('selected_course_id') == $k.idString())
        <option value=$k.idString() selected>$k.listaString()</option>
        #else
        <option value=$k.idString()>$k.listaString()</option>
        #end
    #end
    </select>

##Lisätään key:ksi sivun osoite, sivut joilla on vain numero key:nä ei vie vielä mihinkään!
#set ($services = {1 : "Suoritteiden kirjaus" , "osallistujat.vm" : "Osallistujatietojen muutokset" ,
3 : "Kurssin perustietojen muutokset" , "kurssi.vm" : "Listat" , 5 : "Arvostelu" ,
6 : "Tuloslistat" , 7 : "Kurssin jäädytys"})

#if ($session.getAttribute('selected_course_id'))
<form action="" method=get>
    <select name="serviceId" onChange="this.form.submit()">
    #foreach ($s in $services.entrySet())
        #if($session.getAttribute('selected_service_id') == $s.key)
            <option value=$s.key selected>$s.value</option>
        #else
            <option value=$s.key>$s.value</option>
        #end
    #end
    </select>
    #set ($link = $session.getAttribute('selected_service_id'))
<input type=button value=select onClick="parent.location='$link'">
##$link
#end
</form>
</form>

</div>
<pre>
##</body>
##<html>
