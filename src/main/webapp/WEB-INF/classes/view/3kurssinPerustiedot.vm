#parse("top.vm")

<h1>$bundle.getString("3coursebasics")</h1>

#if ($valittuKurssi.getTila() == "J")
    #set ($jaassa = true)
#else
    #set ($jaassa = false)
#end

#set($Integer = 0)

##Laskareiden get-parametrit
    #set($lh = $params.getParameter('lh'))
    #set($lh_p = $request.getParameter('lh_p'))
    #set($lh_lp = $request.getParameter('lh_lp'))
    #set($arv_asteikko = $request.getParameter('arvosteluasteikko'))
    #if($lh)
        $valittuKurssi.setLaskarikerta_lkm($Integer.parseInt($lh))
    #end
    #if($lh_p)
        $valittuKurssi.setPakolliset_laskaritehtava_lkm($Integer.parseInt($lh_p))
    #end
    #if($lh_lp)
        $valittuKurssi.setMax_laskaripisteet($Integer.parseInt($lh_lp))
    #end

##Harjoitustöiden get-parametrit
    #set($ht = $request.getParameter('ht'))
    #set($ht_p = $request.getParameter('ht_p'))
    #set($ht_lp = $request.getParameter('ht_lp'))
    #if($ht)
        $valittuKurssi.setHarjoitustyo_lkm($Integer.parseInt($ht))
    #end
    #if($ht_p)
        $valittuKurssi.setPakolliset_harjoitustyo_lkm($Integer.parseInt($ht_p))
    #end
    #if($ht_lp)
        $valittuKurssi.setHarjoitustyopisteet($Integer.parseInt($ht_lp))
    #end

##Kokeiden get-parametrit
    #set($koe = $request.getParameter('koe'))
    #set($koe_p = $request.getParameter('koe_p'))
    #if($koe)
        $valittuKurssi.setValikokeet_lkm($Integer.parseInt($koe))
    #end
    #if($koe_p)
        $valittuKurssi.setPakolliset_koe_lkm($Integer.parseInt($koe_p))
    #end
    #if($arv_asteikko)
        $valittuKurssi.setArvosteluasteikko($arv_asteikko)
    #end

##Tallennetaan kurssi kantaan
$KurssiKyselyt.tallennaKantaan($valittuKurssi)

##Tässä määritellään säädettäville kentille otsikot, niiden arvot tietokantaoliosta, ja get -parametrien arvo
#set($basics = {
    $bundle.getString("laskuharjoituksia") : [
            [""                               ,$valittuKurssi.laskarikerta_lkm, "lh"], 
            [$bundle.getString("jpakollisia") ,$valittuKurssi.pakolliset_laskaritehtava_lkm, "lh_p"], 
            [$bundle.getString("lisapisteet") ,$valittuKurssi.max_laskaripisteet, "lh_lp"]
        ],
    $bundle.getString("harjoitustoita") : [
            [""                                ,$valittuKurssi.harjoitustyo_lkm, "ht"], 
            [$bundle.getString("jpakollisia")  ,$valittuKurssi.pakolliset_harjoitustyo_lkm, "ht_p" ], 
            [$bundle.getString("lisapisteet")  ,$valittuKurssi.harjoitustyopisteet, "ht_lp"]
        ],
    $bundle.getString("kokeita") : [
            [ ""                               ,$valittuKurssi.valikokeet_lkm, "koe"], 
            [ $bundle.getString("jpakollisia") ,$valittuKurssi.pakolliset_koe_lkm, "koe_p"]
        ]
    }
)

<style>
    .perustietorivi{
        margin-bottom: 10px;
    }
    .perustietosarake {
        display: inline-block;
        width: 230px;
    }
    .perustieto-otsake {
        display:inline-block;
        width: 120px;
    }
    .perustieto-input {
        display:inline-block;
        width: 50px;
    }
    .center {
        margin-left:auto;
        margin-right:auto;
    }
    .perustietosection {
        padding: 15px;
        padding-top: 50px;
        padding-bottom: 50px;
        background-color: #F0EFD5;
        border: 5px solid;
        border-color: lightgray white white lightgray;
    }
</style>
<div class=section>
<form name="kurssinPerustiedot" action="" method=get>
    #foreach($otsikko in $basics.keySet()) ##Otsikko tässä joko Laskuharjoitukset, Harjoitustyöt tai Kokeet
        ##<h3>$otsikko</h3>
        <div class="perustietorivi">
        #foreach($alaotsikko in $basics.get($otsikko))
            #set($nimi = $alaotsikko.get(0))
            #set($kentta = $alaotsikko.get(1))
            #set($parametri = $alaotsikko.get(2))
                <div class="perustietosarake">
                    <div class="perustieto-otsake">
                        #if($nimi.equals(""))$otsikko#end
                        $nimi
                    </div>
                        <input type="text" 
                        class="form-control perustieto-input"
                        name="$parametri" ##get-parametria varten, "lh", "lh_p" jne...
                        value="$kentta" ##arvo valitun kurssin oliolta
                        #if($jaassa) readonly #end>
                </div>
        #end
        </div>
    #end
    <br>
    <p> <b>$bundle.getString("arvasteikko"):</b>
        <input type="radio" name="arvosteluasteikko" value="K" #if($valittuKurssi.arvostellaanko.equals("K")) checked #end>$bundle.getString('arvosanat')
        <input type="radio" name="arvosteluasteikko" value="E" #if($valittuKurssi.arvostellaanko.equals("E")) checked #end>$bundle.getString('hyvhyl')
    </p>
    <br>

    <input type=submit class="btn" value=$bundle.getString("tmuutokset") onClick="">
</form>
</div>
#parse("osasuoritustenRajat.vm")